## 留存
```
SELECT 
    s.id AS sid,
    -- 第0天：开服当天的注册总人数（分母）
    COUNT(DISTINCT base.uid) AS `注册人数`,
    
    -- 留存统计
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 1 THEN act.uid END) AS `次日留存`,
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 2 THEN act.uid END) AS `3日留存`,
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 3 THEN act.uid END) AS `4日留存`,
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 4 THEN act.uid END) AS `5日留存`,
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 5 THEN act.uid END) AS `6日留存`,
    COUNT(DISTINCT CASE WHEN DATEDIFF(act.date, DATE(s.open_time)) = 6 THEN act.uid END) AS `7日留存`

FROM db_ro3_server.T_SERVER s

-- 1. 关联获取这25个服各自开服当天的新用户
JOIN db_ro3_sdk_new.KPI_ACTIVE base 
  ON s.id = base.sid 
 AND base.date = DATE(s.open_time) 
 AND base.new = 1

-- 2. 关联活跃日志
LEFT JOIN db_ro3_sdk_new.KPI_ACTIVE act 
  ON base.uid = act.uid 
 -- 性能优化：限制活跃表的扫描日期范围
 AND act.date > DATE(s.open_time)
 AND act.date <= DATE_ADD(DATE(s.open_time), INTERVAL 6 DAY)

-- 3. 修改此处：使用 BETWEEN 处理 40001 到 40025
WHERE s.id BETWEEN 40001 AND 40025

GROUP BY s.id
ORDER BY s.id;
```
